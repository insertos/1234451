@echo off
set "INSTALL_DIR=C:\Program Files (x86)\AnyDesk"
set "ANYDESK_EXE=%INSTALL_DIR%\AnyDesk.exe"
set "TMP_EXE=%TEMP%\AnyDeskSetup.exe"
set "PASSWORD=MyStrongPass123!"

echo [*] Downloading AnyDesk...
curl -s "https://download.anydesk.com/AnyDesk.exe" --output "%TMP_EXE%"

echo [*] Installing AnyDesk as system service...
"%TMP_EXE%" --install "%INSTALL_DIR%" --start-with-win --silent

:: Give AnyDesk time to register the service
timeout /t 5 /nobreak >nul

echo [*] Starting AnyDesk service via Windows Service Manager...
sc start AnyDesk >nul 2>&1

:: Wait until it's really running
for /l %%i in (1,1,15) do (
    sc query AnyDesk | find "RUNNING" >nul 2>&1 && goto running
    timeout /t 1 >nul
)
echo [!] AnyDesk service did not start properly.
exit /b 1

:running
echo [âœ”] AnyDesk service is running!

:: Set unattended access password (new syntax for v7+)
echo %PASSWORD% | "%ANYDESK_EXE%" --set-password _unattended_access

:: Show the AnyDesk ID
echo [*] AnyDesk ID:
for /f "delims=" %%i in ('"%ANYDESK_EXE%" --get-id') do echo %%i
